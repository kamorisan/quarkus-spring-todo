# APIãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ

ã“ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã¯ã€Todo APIã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹ãŸã‚ã®3ã¤ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒã‚ã‚Šã¾ã™ã€‚

## ğŸ“‹ ã‚¹ã‚¯ãƒªãƒ—ãƒˆä¸€è¦§

### 1. smoke_test.sh - ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ãƒ¢ãƒ¼ã‚¯ãƒ†ã‚¹ãƒˆï¼ˆæ¨å¥¨ï¼‰

æœ€ã‚‚ç°¡å˜ã§é«˜é€Ÿãªãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆã€‚ãƒ“ãƒ«ãƒ‰å¾Œã®å‹•ä½œç¢ºèªã«æœ€é©ã€‚

```bash
# Quarkusã‚’ãƒ†ã‚¹ãƒˆï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: ãƒãƒ¼ãƒˆ8081ï¼‰
./bench/smoke_test.sh

# Spring Bootã‚’ãƒ†ã‚¹ãƒˆï¼ˆãƒãƒ¼ãƒˆ8082ï¼‰
./bench/smoke_test.sh 8082
```

**å®Ÿè¡Œæ™‚é–“**: ç´„2ç§’

**ãƒ†ã‚¹ãƒˆå†…å®¹**:
- âœ“ Health check
- âœ“ Todoä½œæˆï¼ˆPOSTï¼‰
- âœ“ ä¸€è¦§å–å¾—ï¼ˆGETï¼‰
- âœ“ IDæŒ‡å®šå–å¾—ï¼ˆGETï¼‰
- âœ“ æ›´æ–°ï¼ˆPATCHï¼‰
- âœ“ å‰Šé™¤ï¼ˆDELETEï¼‰

**å‡ºåŠ›ä¾‹**:
```
=========================================
  Quick Smoke Test
  Testing: http://localhost:8081
=========================================

1. Health check... âœ“
2. Create todo... âœ“ (ID: 1a2b3c4d...)
3. List todos... âœ“
4. Get by ID... âœ“
5. Update todo... âœ“
6. Delete todo... âœ“

All smoke tests passed! âœ“
```

---

### 2. test_api.sh - è©³ç´°APIãƒ†ã‚¹ãƒˆ

å…¨ã¦ã®CRUDæ“ä½œã¨ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è©³ç´°ã«ãƒ†ã‚¹ãƒˆã—ã¾ã™ã€‚

```bash
# Quarkusã‚’ãƒ†ã‚¹ãƒˆ
./bench/test_api.sh

# Spring Bootã‚’ãƒ†ã‚¹ãƒˆ
./bench/test_api.sh 8082
```

**å®Ÿè¡Œæ™‚é–“**: ç´„5ç§’

**ãƒ†ã‚¹ãƒˆå†…å®¹**:
1. **CREATE (POST)**
   - è¤‡æ•°ã®Todoä½œæˆ
   - å®Œäº†æ¸ˆã¿Todoã®ä½œæˆ

2. **READ (GET)**
   - å…¨Todoå–å¾—
   - IDæŒ‡å®šå–å¾—

3. **UPDATE (PUT)**
   - å…¨ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰æ›´æ–°

4. **PARTIAL UPDATE (PATCH)**
   - éƒ¨åˆ†æ›´æ–°ï¼ˆcompletedãƒ•ãƒ©ã‚°ã®ã¿ï¼‰

5. **DELETE**
   - å‰Šé™¤
   - å‰Šé™¤ç¢ºèªï¼ˆ404ãƒã‚§ãƒƒã‚¯ï¼‰

6. **VALIDATION**
   - ç©ºã®titleã§ã‚¨ãƒ©ãƒ¼ï¼ˆ400ï¼‰
   - titleãªã—ã§ã‚¨ãƒ©ãƒ¼ï¼ˆ400ï¼‰
   - å­˜åœ¨ã—ãªã„IDï¼ˆ404ï¼‰

**å‡ºåŠ›ä¾‹**:
```
=========================================
  Todo API Test Suite
  Testing: http://localhost:8081
=========================================

âœ“ Server is ready

=========================================
  1. CREATE (POST)
=========================================

Test: Create Todo 1
âœ“ Status: 201 (expected 201)
{
  "id": "1a2b3c4d-...",
  "title": "Buy groceries",
  "description": "Milk, eggs, bread",
  "completed": false
}

... (çœç•¥)

=========================================
  Test Summary
=========================================

Tests Passed: 12
Tests Failed: 0

All tests passed! âœ“
```

---

### 3. test_all_modes.sh - å…¨ãƒ¢ãƒ¼ãƒ‰è‡ªå‹•ãƒ†ã‚¹ãƒˆ

3ã¤ã®ãƒ¢ãƒ¼ãƒ‰ï¼ˆNativeã€Quarkus JVMã€Spring JVMï¼‰ã‚’è‡ªå‹•çš„ã«ãƒ†ã‚¹ãƒˆã—ã¾ã™ã€‚

```bash
./bench/test_all_modes.sh
```

**å®Ÿè¡Œæ™‚é–“**: ç´„2åˆ†

**å‹•ä½œ**:
1. ãƒ“ãƒ«ãƒ‰æˆæœç‰©ã®ç¢ºèª
2. å„ãƒ¢ãƒ¼ãƒ‰ã‚’é †ç•ªã«ï¼š
   - èµ·å‹•
   - ã‚¹ãƒ¢ãƒ¼ã‚¯ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
   - åœæ­¢
3. å…¨ä½“çµæœè¡¨ç¤º

**å‡ºåŠ›ä¾‹**:
```
=========================================
  API Tests for All Modes
  (3-Way Test Runner)
=========================================

Available modes:
  Quarkus Native: âœ“
  Quarkus JVM:    âœ“
  Spring JVM:     âœ“

=========================================
  Testing Quarkus Native
=========================================

Starting Quarkus Native...
Running tests...
... (ã‚¹ãƒ¢ãƒ¼ã‚¯ãƒ†ã‚¹ãƒˆçµæœ)
Stopping Quarkus Native...

=========================================
  Testing Quarkus JVM
=========================================
... (åŒæ§˜)

=========================================
  Testing Spring Boot JVM
=========================================
... (åŒæ§˜)

=========================================
  All Tests Complete!
=========================================

All modes passed smoke tests âœ“
```

---

## ğŸš€ ä½¿ã„æ–¹

### åŸºæœ¬çš„ãªãƒ•ãƒ­ãƒ¼

1. **ã‚¢ãƒ—ãƒªã‚’ãƒ“ãƒ«ãƒ‰**
```bash
./build_all.sh
```

2. **ã‚¢ãƒ—ãƒªã‚’èµ·å‹•**
```bash
# Quarkus Native
./quarkus-todo/target/quarkus-todo-1.0.0-SNAPSHOT-runner

# ã¾ãŸã¯ Quarkus JVM
java -jar quarkus-todo/target/quarkus-app/quarkus-run.jar

# ã¾ãŸã¯ Spring Boot
java -jar spring-todo/target/spring-todo-0.0.1-SNAPSHOT.jar
```

3. **ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ**ï¼ˆåˆ¥ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§ï¼‰
```bash
# ã‚¯ã‚¤ãƒƒã‚¯ãƒ†ã‚¹ãƒˆ
./bench/smoke_test.sh

# è©³ç´°ãƒ†ã‚¹ãƒˆ
./bench/test_api.sh
```

### è‡ªå‹•ãƒ†ã‚¹ãƒˆï¼ˆå…¨ãƒ¢ãƒ¼ãƒ‰ï¼‰

ã‚¢ãƒ—ãƒªã‚’èµ·å‹•ã›ãšã«å®Ÿè¡Œï¼š

```bash
./bench/test_all_modes.sh
```

ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒè‡ªå‹•çš„ã«èµ·å‹•ãƒ»ãƒ†ã‚¹ãƒˆãƒ»åœæ­¢ã‚’è¡Œã„ã¾ã™ã€‚

---

## ğŸ’¡ Tips

### CI/CDã§ã®åˆ©ç”¨

```bash
# ãƒ“ãƒ«ãƒ‰ + å…¨ãƒ¢ãƒ¼ãƒ‰ãƒ†ã‚¹ãƒˆ
./build_all.sh && ./bench/test_all_modes.sh
```

### ã‚«ã‚¹ã‚¿ãƒ ãƒãƒ¼ãƒˆã§ã®ãƒ†ã‚¹ãƒˆ

```bash
# ãƒãƒ¼ãƒˆ9000ã§èµ·å‹•ã—ãŸã‚¢ãƒ—ãƒªã‚’ãƒ†ã‚¹ãƒˆ
./bench/smoke_test.sh 9000
./bench/test_api.sh 9000
```

### jqãŒãªã„å ´åˆ

ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯`jq`ãŒãªãã¦ã‚‚å‹•ä½œã—ã¾ã™ãŒã€JSONã®æ•´å½¢è¡¨ç¤ºã«ã¯`jq`ãŒã‚ã‚‹ã¨ä¾¿åˆ©ã§ã™ï¼š

```bash
# macOS
brew install jq

# Ubuntu/Debian
sudo apt-get install jq
```

---

## ğŸ” ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### "Server not running"ã‚¨ãƒ©ãƒ¼

```bash
# ã‚¢ãƒ—ãƒªãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‹ç¢ºèª
curl http://localhost:8081/q/health/ready
# ã¾ãŸã¯
curl http://localhost:8082/actuator/health
```

æ­£å¸¸ãªå¿œç­”ãŒè¿”ã‚‰ãªã„å ´åˆã¯ã€ã‚¢ãƒ—ãƒªã®ãƒ­ã‚°ã‚’ç¢ºèªï¼š
```bash
tail -f logs/quarkus-native.log
tail -f logs/quarkus.log
tail -f logs/spring.log
```

### ãƒ†ã‚¹ãƒˆãŒå¤±æ•—ã™ã‚‹

1. **ãƒãƒ¼ãƒˆç•ªå·ã‚’ç¢ºèª**
   - Quarkus: 8081
   - Spring Boot: 8082

2. **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¯ãƒªã‚¢**
   ```bash
   rm -rf data/
   # ã‚¢ãƒ—ãƒªã‚’å†èµ·å‹•
   ```

3. **curl/bcãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª**
   ```bash
   which curl
   which bc
   ```

---

## ğŸ“Š ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã¨ã®çµ„ã¿åˆã‚ã›

ãƒ†ã‚¹ãƒˆã¨ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã‚’çµ„ã¿åˆã‚ã›ãŸå®Œå…¨ãªæ¤œè¨¼ï¼š

```bash
# 1. ãƒ“ãƒ«ãƒ‰
./build_all.sh

# 2. APIãƒ†ã‚¹ãƒˆï¼ˆå‹•ä½œç¢ºèªï¼‰
./bench/test_all_modes.sh

# 3. ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ï¼ˆæ€§èƒ½è¨ˆæ¸¬ï¼‰
./bench/run_benchmark.sh

# 4. çµæœç¢ºèª
./bench/summary.sh
```

---

## ğŸ“ ã¾ã¨ã‚

| ã‚¹ã‚¯ãƒªãƒ—ãƒˆ | ç”¨é€” | æ™‚é–“ | ä½¿ç”¨ã‚¿ã‚¤ãƒŸãƒ³ã‚° |
|-----------|------|------|--------------|
| `smoke_test.sh` | å‹•ä½œç¢ºèª | 2ç§’ | ãƒ“ãƒ«ãƒ‰å¾Œã®æ¯å›ãƒã‚§ãƒƒã‚¯ |
| `test_api.sh` | è©³ç´°æ¤œè¨¼ | 5ç§’ | APIå¤‰æ›´å¾Œã®æ¤œè¨¼ |
| `test_all_modes.sh` | å…¨ãƒ¢ãƒ¼ãƒ‰æ¤œè¨¼ | 2åˆ† | ãƒªãƒªãƒ¼ã‚¹å‰ã®æœ€çµ‚ç¢ºèª |

**æ¨å¥¨**: ã¾ãšã¯ `smoke_test.sh` ã§ç´ æ—©ãå‹•ä½œç¢ºèªã—ã€å•é¡ŒãŒã‚ã‚‹å ´åˆã¯ `test_api.sh` ã§è©³ç´°èª¿æŸ»ã€‚
