# スクリプト解説ガイド

このディレクトリには、プロジェクトの主要スクリプトの詳細解説が含まれています。

## 📚 利用可能なガイド

### メインスクリプト

### 1. [build_all.md](build_all.md) - ビルドスクリプト解説

**対象スクリプト**: `./build_all.sh`

**内容**:
- JVMとNativeの両方を保持する賢い仕組み
- 一時退避メカニズムの詳細
- GraalVM設定の説明
- トラブルシューティング

**こんな人におすすめ**:
- ビルドの仕組みを理解したい
- JVMとNativeの成果物がどう管理されているか知りたい
- ビルドエラーを自分で解決したい

**主な学習内容**:
- `mktemp -d` による安全な一時ディレクトリ作成
- Maven環境変数の正しい設定方法
- エラーハンドリングのベストプラクティス

---

### 2. [test_all_modes.md](test_all_modes.md) - 自動テストスクリプト解説

**対象スクリプト**: `./bench/test_all_modes.sh`

**内容**:
- 自動起動→テスト→停止のフロー
- wait_for_server関数の実装詳細
- プロセス管理とクリーンアップ
- エラーハンドリング

**こんな人におすすめ**:
- 自動テストの仕組みを理解したい
- CI/CD統合を検討している
- Bashスクリプトの書き方を学びたい

**主な学習内容**:
- バックグラウンドプロセスの管理（`&`, `$!`, `wait`）
- ヘルスチェックによる起動確認
- ログファイルへのリダイレクト（`> /tmp/xxx.log 2>&1`）
- エラー時のクリーンアップ処理

---

### テストスクリプト

### 4. [smoke_test.md](smoke_test.md) - クイックスモークテスト解説

**対象スクリプト**: `./bench/smoke_test.sh`

**内容**:
- 6項目の基本CRUD操作テスト
- curlによるHTTPリクエスト
- カラー出力の実装
- 高速テスト（約2秒）

**こんな人におすすめ**:
- ビルド後の動作確認方法を知りたい
- curlコマンドの使い方を学びたい
- シンプルなテストスクリプトを理解したい

**主な学習内容**:
- curlのオプション（`-s`, `-f`, `-w`, `-X`, `-H`, `-d`）
- HTTPステータスコードの取得方法
- ANSIカラーコードの使い方
- 正規表現によるJSONからのID抽出

---

### 5. [test_api.md](test_api.md) - 詳細APIテスト解説

**対象スクリプト**: `./bench/test_api.sh`

**内容**:
- 12項目の包括的なテスト
- 関数による抽象化（test_endpoint）
- バリデーションテスト
- テスト結果のカウント

**こんな人におすすめ**:
- 包括的なAPIテストを実装したい
- Bash関数の書き方を学びたい
- jqコマンドの使い方を知りたい

**主な学習内容**:
- Bash関数の定義とパラメータ
- local変数の使い方
- jqによるJSON処理
- テストカウンタの実装
- エラーでも継続する設計

---

### 3. [run_benchmark.md](run_benchmark.md) - ベンチマークスクリプト解説

**対象スクリプト**: `./bench/run_benchmark.sh`

**内容**:
- 起動時間、メモリ、CPUの計測方法
- 各指標の意味と解釈
- バイナリ種類の判定（Mach-O vs ELF）
- 公平な比較のための工夫

**こんな人におすすめ**:
- ベンチマーク手法を理解したい
- パフォーマンス計測の実装方法を学びたい
- 計測結果の意味を深く知りたい

**主な学習内容**:
- `ps`コマンドによるメモリ・CPU取得
- RSS（Resident Set Size）の意味
- `file`コマンドによるバイナリ判定
- CSVファイルでのデータ保存

---

## 📖 読み方のガイド

### 初めて読む方

#### パターン1: ビルド→テスト→ベンチマーク

1. **[build_all.md](build_all.md)** - ビルドの仕組み
   - ビルドはすべての基礎
   - 成果物がどう生成されるか理解できる

2. **[smoke_test.md](smoke_test.md)** - 基本的なテスト
   - シンプルで理解しやすい
   - curlの使い方を学べる

3. **[test_api.md](test_api.md)** - 詳細なテスト
   - 関数化の手法を学べる
   - バリデーションテストの重要性を理解

4. **[test_all_modes.md](test_all_modes.md)** - テスト自動化
   - テストの自動化手法を学べる
   - プロセス管理を理解

5. **[run_benchmark.md](run_benchmark.md)** - ベンチマーク
   - パフォーマンス計測の全体像を把握
   - 全スクリプトの関係性が理解できる

#### パターン2: テストスクリプトから学ぶ

curlやAPIテストに興味がある方向け：

1. **[smoke_test.md](smoke_test.md)** - 基本から学ぶ
2. **[test_api.md](test_api.md)** - 応用を学ぶ
3. その他のガイドへ

### 特定の問題を解決したい方

| 問題 | 参照ガイド | セクション |
|-----|-----------|----------|
| Nativeビルドが失敗する | [build_all.md](build_all.md) | トラブルシューティング |
| JVM成果物が消える | [build_all.md](build_all.md) | 核心部分: JVM成果物の一時退避 |
| テストが途中で止まる | [test_all_modes.md](test_all_modes.md) | よくある問題と解決方法 |
| ベンチマーク結果がおかしい | [run_benchmark.md](run_benchmark.md) | よくある問題と解決方法 |
| プロセスが残り続ける | [test_all_modes.md](test_all_modes.md) | クリーンアップ関数 |

### Bashスクリプトを学びたい方

各ガイドには実践的なBashテクニックが含まれています：

**[build_all.md](build_all.md)** で学べること:
- `set -e` によるエラーハンドリング
- `mktemp -d` による安全な一時ファイル操作
- 条件分岐と環境変数の活用

**[test_all_modes.md](test_all_modes.md)** で学べること:
- 関数の定義と使い方
- バックグラウンドプロセスの管理
- ループと待機処理

**[run_benchmark.md](run_benchmark.md)** で学べること:
- 複数スクリプトの連携
- `ps`コマンドによるプロセス監視
- `file`コマンドによるファイル判定

**[smoke_test.md](smoke_test.md)** で学べること:
- curlの基本的な使い方
- HTTPステータスコードの取得
- ANSIカラーコード
- 正規表現によるデータ抽出

**[test_api.md](test_api.md)** で学べること:
- Bash関数の定義と使用
- local変数
- jqによるJSON処理
- テストカウンタの実装

---

## 🔗 関連ドキュメント

### ユーザー向けドキュメント

- [../README.md](../README.md) - プロジェクト全体のREADME
- [../MANUAL_TEST_GUIDE.md](../MANUAL_TEST_GUIDE.md) - 手動APIテストガイド
- [../bench/TEST_README.md](../bench/TEST_README.md) - テストスクリプトの使い方
- [../demo_exe.md](../demo_exe.md) - 詳細な実行ガイド

### 開発者向けドキュメント

- [../sample_app_design.md](../sample_app_design.md) - アプリケーション設計ドキュメント

---

## 💡 各ガイドの特徴

### 詳細度

| ガイド | 行数 | 詳細度 | 難易度 |
|-------|-----|--------|-------|
| build_all.md | ~600行 | ★★★★★ | 中級 |
| test_all_modes.md | ~800行 | ★★★★★ | 中級～上級 |
| run_benchmark.md | ~900行 | ★★★★★ | 上級 |
| smoke_test.md | ~700行 | ★★★★★ | 初級～中級 |
| test_api.md | ~900行 | ★★★★★ | 中級 |

### 含まれる内容

すべてのガイドに以下が含まれます：
- ✅ スクリプト全体の構造
- ✅ 各セクションの詳細解説
- ✅ コード例と出力例
- ✅ よくある問題と解決方法
- ✅ 工夫点のまとめ
- ✅ 使用例

---

## 📝 フィードバック

これらのガイドに関する質問や改善提案があれば、お気軽にお知らせください。

---

**最終更新**: 2026-02-27
